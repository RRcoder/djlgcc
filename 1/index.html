<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Seleccionar Cliente</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- DataTables -->
    <link href="https://cdn.jsdelivr.net/npm/datatables.net-bs5@2.0.3/css/dataTables.bootstrap5.min.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>

<div class="container mt-5">
    <form>
        <div class="mb-3">
            <label class="form-label">Cliente</label>

            <div class="input-group">
                <select class="form-select" id="clienteSelect" disabled>
                    <option value="">Seleccione un cliente</option>
                </select>

                <button
                    type="button"
                    class="btn btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#clienteModal">
                    Seleccionar
                </button>
            </div>
        </div>
    </form>
</div>

<!-- MODAL -->
<div class="modal fade" id="clienteModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Seleccionar Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <table id="tablaClientes"
                       class="table table-striped table-bordered w-100">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>N° Documento</th>
                            <th>Acción</th>
                        </tr>
                        <tr class="filters">
                            <th><input type="text" class="form-control form-control-sm" placeholder="ID"></th>
                            <th><input type="text" class="form-control form-control-sm" placeholder="Nombre"></th>
                            <th><input type="text" class="form-control form-control-sm" placeholder="Documento"></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- DataTables -->
<script src="https://cdn.jsdelivr.net/npm/datatables.net@2.0.3/js/dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/datatables.net-bs5@2.0.3/js/dataTables.bootstrap5.min.js"></script>

<script>
/* ===============================
   DATOS MOCK (100 CLIENTES)
================================ */
const clientes = [];

for (let i = 1; i <= 100; i++) {
    clientes.push({
        id: i,
        nombre: `Cliente ${i}`,
        numero_documento: (10000000 + i).toString()
    });
}

let table;

$(document).ready(function () {

    table = $('#tablaClientes').DataTable({
        data: clientes,
        width: '100%',
        autoWidth: false,
        orderCellsTop: true,
        fixedHeader: true,
        pageLength: 10,
        columns: [
            { data: 'id' },
            { data: 'nombre' },
            { data: 'numero_documento' },
            {
                data: null,
                orderable: false,
                searchable: false,
                render: data => `
                    <button class="btn btn-success btn-sm seleccionar"
                            data-id="${data.id}"
                            data-nombre="${data.nombre}">
                        Seleccionar
                    </button>`
            }
        ],
        language: {
            search: "Buscar global:",
            lengthMenu: "Mostrar _MENU_",
            info: "Mostrando _START_ a _END_ de _TOTAL_ clientes",
            paginate: {
                next: "Siguiente",
                previous: "Anterior"
            }
        },
        initComplete: function () {
            const api = this.api();

            api.columns().every(function (i) {
                const column = this;
                $('input', $('.filters th').eq(i)).on('keyup change clear', function () {
                    if (column.search() !== this.value) {
                        column.search(this.value).draw();
                    }
                });
            });
        }
    });

    // Forzar ajuste de ancho al abrir modal
    $('#clienteModal').on('shown.bs.modal', function () {
        table.columns.adjust();
    });

    // Selección de cliente
    $('#tablaClientes').on('click', '.seleccionar', function () {
        const id = $(this).data('id');
        const nombre = $(this).data('nombre');

        $('#clienteSelect')
            .prop('disabled', false)
            .html(`<option value="${id}" selected>${nombre}</option>`);

        bootstrap.Modal.getInstance(
            document.getElementById('clienteModal')
        ).hide();
    });
});
</script>

</body>
</html>

